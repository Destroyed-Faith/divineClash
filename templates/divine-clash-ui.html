<div class="divine-clash-container">
  <div class="divine-clash-header">
    <div>
      <h2>Divine Clash</h2>
      <div class="ready-summary">
        Ready: {{readySummary.ready}} / {{readySummary.total}}
      </div>
    </div>
    <div class="clash-controls">
      {{#if isGM}}
      <button class="reveal-btn" data-action="reveal">Reveal Allocations</button>
      <button class="resolve-btn" data-action="resolve">Resolve Combat</button>
      <button class="regenerate-btn" data-action="regenerate">Regenerate</button>
      {{/if}}
    </div>
  </div>

  <div class="participants-container">
    {{#each participants}}
    <div class="participant-panel" data-user-id="{{userId}}" data-owner="{{isOwner}}" data-total-ready="{{ready.length}}">
      <div class="participant-header">
        <div>
          <h3>{{actorName}}</h3>
          <div class="vitality-display">
            <span class="vitality-label">Vitality:</span>
            <span class="vitality-value {{#if (lt vitality 3)}}low-vitality{{/if}}">{{vitality}}/{{vitalityMax}}</span>
          </div>
        </div>
        <div class="status-pill {{#if allocation.ready}}ready{{else}}pending{{/if}}">
          {{#if allocation.ready}}Ready{{else}}Distributing{{/if}}
        </div>
      </div>

      <div class="stone-pools">
        <div class="stone-pool exhausted">
          <h4>Exhausted</h4>
          <div class="stone-count">{{exhausted.length}}</div>
          <div class="stone-visual">
            {{#each exhausted}}
            <div class="stone stone-exhausted" title="Exhausted Stone"></div>
            {{/each}}
          </div>
        </div>
        <div class="stone-pool burned">
          <h4>Burned</h4>
          <div class="stone-count">{{burned.length}}</div>
          <div class="stone-visual">
            {{#each burned}}
            <div class="stone stone-burned" title="Burned Stone"></div>
            {{/each}}
          </div>
        </div>
      </div>

      <div class="allocation-section">
        {{#if isOwner}}
          {{#if allocation.ready}}
            <div class="allocation-summary">
              <div>Active Stones (Attack): <strong>{{allocation.attack}}</strong></div>
              <div>Active Stones (Defense): <strong>{{allocation.defense}}</strong></div>
            </div>
            <div class="distribution-actions">
              <button class="reset-allocation-btn" data-action="reset" data-user-id="{{userId}}">Adjust Allocation</button>
            </div>
          {{else}}
            <div class="distribution-board">
              <div class="allocation-zones">
                <div class="stone-drop-zone attack-zone" data-zone="attack">
                  <div class="zone-header">Active Stones (Attack) <span class="zone-count">0</span></div>
                  <div class="stone-zone-body"></div>
                </div>
                <div class="stone-drop-zone defense-zone" data-zone="defense">
                  <div class="zone-header">Active Stones (Defense) <span class="zone-count">0</span></div>
                  <div class="stone-zone-body"></div>
                </div>
              </div>
              <div class="ready-zone stone-drop-zone" data-zone="ready">
                <div class="zone-header">Available Stones <span class="zone-count ready-count">{{ready.length}}</span></div>
                <div class="stone-zone-body">
                  {{#each ready}}
                    <div class="stone-cube stone-draggable" draggable="true" data-stone-id="{{#if id}}{{id}}{{else}}{{@index}}{{/if}}"></div>
                  {{/each}}
                </div>
                <div class="vitality-track">
                  <div class="vitality-header">Vitality (HP): {{vitality}}</div>
                  <div class="vitality-stones">
                    {{#repeat vitality}}
                      <div class="vitality-stone"></div>
                    {{/repeat}}
                  </div>
                </div>
              </div>
            </div>
            <div class="distribution-actions">
              <button class="finish-btn" data-action="finish" disabled>Finished Distributing</button>
            </div>
          {{/if}}
        {{else}}
          <div class="allocation-summary viewer">
            {{#if (or ../isGM allocation.revealed)}}
              <div>Active Stones (Attack): <strong>{{allocation.attack}}</strong></div>
              <div>Active Stones (Defense): <strong>{{allocation.defense}}</strong></div>
            {{else}}
              <div class="hidden-allocation">Allocation Hidden</div>
            {{/if}}
          </div>
        {{/if}}
      </div>

      {{#if isOwner}}
      <div class="overdrive-section-panel">
        <label>
          <input type="checkbox" class="overdrive-checkbox">
          Activate Overdrive
        </label>
        <div class="overdrive-inputs" style="display: none;">
          <div class="overdrive-input">
            <label>Burn Stones:</label>
            <input type="number" class="burn-input" value="0" min="0" max="10">
          </div>
          <div class="overdrive-input">
            <label>Attack Bonus:</label>
            <input type="number" class="attack-bonus-input" value="0" min="0" max="40">
          </div>
          <div class="overdrive-input">
            <label>Defense Bonus:</label>
            <input type="number" class="defense-bonus-input" value="0" min="0" max="40">
          </div>
        </div>
      </div>
      {{/if}}
    </div>
    {{/each}}
  </div>

  {{#if isGM}}
  <div class="team-actions-section">
    <h3>Team Actions</h3>
    <div class="team-controls">
      <button class="combined-attack-btn" data-action="combined-attack">Combined Attack</button>
      <button class="group-defense-btn" data-action="group-defense">Group Defense</button>
    </div>
  </div>
  {{/if}}
</div>
